# 4장 네트워크 계층 프로토콜

## 학습 목표
- IP 주소 체계(IPv4/IPv6)의 구조와 특성을 이해한다
- 서브네팅과 VLSM 기법을 학습한다
- ICMP, ARP, RARP 프로토콜의 동작 원리를 파악한다

## 4.1 IP 주소 체계

### 4.1.1 IPv4 주소 체계

#### IPv4 주소 구조
- **주소 길이**: 32비트 (4바이트)
- **표현 방법**: 점분 십진 표기법 (Dotted Decimal Notation)
- **예시**: 192.168.1.100
- **주소 구성**: 네트워크 부분 + 호스트 부분

#### IPv4 주소 클래스
**클래스 A**
- **주소 범위**: 1.0.0.0 ~ 126.255.255.255
- **기본 서브넷 마스크**: 255.0.0.0 (/8)
- **네트워크 개수**: 126개
- **호스트 개수**: 16,777,214개 (2^24 - 2)
- **특징**: 대규모 네트워크용

**클래스 B**
- **주소 범위**: 128.0.0.0 ~ 191.255.255.255
- **기본 서브넷 마스크**: 255.255.0.0 (/16)
- **네트워크 개수**: 16,384개
- **호스트 개수**: 65,534개 (2^16 - 2)
- **특징**: 중간 규모 네트워크용

**클래스 C**
- **주소 범위**: 192.0.0.0 ~ 223.255.255.255
- **기본 서브넷 마스크**: 255.255.255.0 (/24)
- **네트워크 개수**: 2,097,152개
- **호스트 개수**: 254개 (2^8 - 2)
- **특징**: 소규모 네트워크용

**클래스 D (멀티캐스트)**
- **주소 범위**: 224.0.0.0 ~ 239.255.255.255
- **용도**: 멀티캐스트 통신
- **특징**: 호스트 할당 불가

**클래스 E (실험용)**
- **주소 범위**: 240.0.0.0 ~ 255.255.255.255
- **용도**: 실험 및 연구용
- **특징**: 상용 네트워크에서 사용 불가

#### 특수 IPv4 주소
**사설 IP 주소 (Private IP Address)**
- **클래스 A**: 10.0.0.0/8
- **클래스 B**: 172.16.0.0/12 ~ 172.31.0.0/12
- **클래스 C**: 192.168.0.0/16
- **특징**: 인터넷 라우팅 불가, NAT 필요

**루프백 주소 (Loopback Address)**
- **주소**: 127.0.0.0/8
- **용도**: 자기 자신을 가리키는 주소
- **대표 주소**: 127.0.0.1 (localhost)

**링크 로컬 주소 (Link-Local Address)**
- **주소**: 169.254.0.0/16
- **용도**: DHCP 실패 시 자동 할당
- **특징**: 동일 링크 내에서만 유효

**브로드캐스트 주소**
- **제한적 브로드캐스트**: 255.255.255.255
- **지시적 브로드캐스트**: 네트워크 주소의 호스트 부분을 모두 1로 설정

### 4.1.2 IPv6 주소 체계

#### IPv6 도입 배경
- **IPv4 주소 고갈**: 32비트로는 인터넷 확장에 한계
- **보안 강화**: 내장된 IPSec 지원
- **QoS 개선**: 플로우 레이블을 통한 QoS 지원
- **단순화**: 헤더 구조 단순화

#### IPv6 주소 구조
- **주소 길이**: 128비트 (16바이트)
- **표현 방법**: 콜론 16진 표기법 (Colon Hexadecimal Notation)
- **예시**: 2001:0db8:85a3:0000:0000:8a2e:0370:7334
- **압축 표기**: 2001:db8:85a3::8a2e:370:7334

#### IPv6 주소 단축 규칙
**연속된 0 생략**
- **원본**: 2001:0db8:0000:0000:0000:0000:0000:0001
- **단축**: 2001:db8::1

**앞자리 0 생략**
- **원본**: 2001:0db8:0001:0000:0000:0ab0:0000:0001
- **단축**: 2001:db8:1::ab0:0:1

#### IPv6 주소 유형
**유니캐스트 (Unicast)**
- **글로벌 유니캐스트**: 2000::/3 (인터넷 라우팅 가능)
- **링크 로컬**: fe80::/10 (동일 링크 내에서만 유효)
- **유니크 로컬**: fc00::/7 (사설 주소, RFC 4193)
- **루프백**: ::1/128

**멀티캐스트 (Multicast)**
- **주소 범위**: ff00::/8
- **모든 노드**: ff02::1
- **모든 라우터**: ff02::2

**애니캐스트 (Anycast)**
- **개념**: 동일한 주소를 가진 여러 노드 중 가장 가까운 노드로 전송
- **용도**: 로드 밸런싱, 서비스 가용성 향상

## 4.2 서브네팅과 VLSM

### 4.2.1 서브네팅 (Subnetting)

#### 서브네팅의 개념
- **정의**: 하나의 네트워크를 여러 개의 작은 서브네트워크로 분할
- **목적**: IP 주소 효율적 사용, 브로드캐스트 도메인 분할, 보안 향상
- **방법**: 호스트 비트를 네트워크 비트로 변환

#### 서브넷 마스크 (Subnet Mask)
- **역할**: 네트워크 부분과 호스트 부분을 구분
- **표현**: 십진 표기법 또는 CIDR 표기법
- **예시**: 255.255.255.0 = /24

#### 서브네팅 계산 과정
**1단계: 필요한 서브넷 수 결정**
- 서브넷 비트 수 = log₂(필요한 서브넷 수)
- 2ⁿ ≥ 필요한 서브넷 수

**2단계: 서브넷 마스크 계산**
- 기본 마스크에서 서브넷 비트만큼 확장

**3단계: 서브넷 주소 범위 계산**
- 서브넷 간격 = 2^(남은 호스트 비트 수)

#### 서브네팅 예시
**문제**: 192.168.1.0/24를 4개의 서브넷으로 분할

**해결과정**:
1. 필요한 비트 수: 2² = 4, 따라서 2비트 필요
2. 새로운 서브넷 마스크: /26 (255.255.255.192)
3. 서브넷 간격: 2⁶ = 64
4. 서브넷 주소:
   - 192.168.1.0/26 (192.168.1.1 ~ 192.168.1.62)
   - 192.168.1.64/26 (192.168.1.65 ~ 192.168.1.126)
   - 192.168.1.128/26 (192.168.1.129 ~ 192.168.1.190)
   - 192.168.1.192/26 (192.168.1.193 ~ 192.168.1.254)

### 4.2.2 VLSM (Variable Length Subnet Mask)

#### VLSM의 개념
- **정의**: 서로 다른 크기의 서브넷 마스크를 사용하는 기법
- **장점**: IP 주소 낭비 최소화, 유연한 네트워크 설계
- **요구사항**: 클래스리스 라우팅 프로토콜 (OSPF, EIGRP, BGP)

#### VLSM 설계 원칙
1. **큰 서브넷부터 할당**: 가장 많은 호스트가 필요한 서브넷부터
2. **2의 거듭제곱 원칙**: 호스트 수는 2ⁿ - 2 (네트워크 주소와 브로드캐스트 주소 제외)
3. **주소 낭비 최소화**: 필요한 호스트 수에 가장 가까운 서브넷 크기 선택

#### VLSM 설계 예시
**요구사항**: 
- 본사: 100대의 호스트
- 지사 A: 50대의 호스트  
- 지사 B: 25대의 호스트
- WAN 링크: 2대의 라우터

**할당 네트워크**: 192.168.1.0/24

**해결과정**:
1. **본사 (100대)**: 2⁷ = 128 > 100, /25 사용
   - 192.168.1.0/25 (192.168.1.1 ~ 192.168.1.126)

2. **지사 A (50대)**: 2⁶ = 64 > 50, /26 사용
   - 192.168.1.128/26 (192.168.1.129 ~ 192.168.1.190)

3. **지사 B (25대)**: 2⁵ = 32 > 25, /27 사용
   - 192.168.1.192/27 (192.168.1.193 ~ 192.168.1.222)

4. **WAN 링크 (2대)**: 2² = 4 > 2, /30 사용
   - 192.168.1.224/30 (192.168.1.225 ~ 192.168.1.226)

### 4.2.3 CIDR (Classless Inter-Domain Routing)

#### CIDR의 개념
- **정의**: 클래스 기반 주소 체계를 벗어난 주소 할당 방식
- **표기법**: 네트워크 주소/프리픽스 길이 (예: 192.168.0.0/16)
- **장점**: 라우팅 테이블 크기 감소, 주소 공간 효율적 사용

#### 슈퍼네팅 (Supernetting)
- **정의**: 여러 개의 연속된 네트워크를 하나로 통합
- **목적**: 라우팅 테이블 크기 축소, 라우팅 효율성 향상
- **예시**: 
  - 192.168.0.0/24, 192.168.1.0/24, 192.168.2.0/24, 192.168.3.0/24
  - → 192.168.0.0/22 (슈퍼넷)

## 4.3 ICMP (Internet Control Message Protocol)

### 4.3.1 ICMP 개요

#### ICMP의 역할
- **정의**: IP의 오류 보고 및 진단 프로토콜
- **특징**: IP 프로토콜의 일부이지만 별도의 기능 수행
- **캡슐화**: IP 헤더 다음에 위치 (Protocol Number: 1)

#### ICMP 메시지 분류
**오류 메시지 (Error Messages)**
- Destination Unreachable (Type 3)
- Source Quench (Type 4)
- Redirect (Type 5)
- Time Exceeded (Type 11)
- Parameter Problem (Type 12)

**정보 메시지 (Informational Messages)**
- Echo Request (Type 8)
- Echo Reply (Type 0)
- Timestamp Request (Type 13)
- Timestamp Reply (Type 14)

### 4.3.2 주요 ICMP 메시지

#### Destination Unreachable (Type 3)
**Code 값에 따른 세부 분류**:
- Code 0: Network Unreachable
- Code 1: Host Unreachable
- Code 2: Protocol Unreachable
- Code 3: Port Unreachable
- Code 4: Fragmentation Needed and DF Set
- Code 5: Source Route Failed

#### Time Exceeded (Type 11)
**Code 값**:
- Code 0: TTL Exceeded in Transit
- Code 1: Fragment Reassembly Time Exceeded

**활용**: traceroute 명령어의 동작 원리

#### Echo Request/Reply (Type 8/0)
- **용도**: 네트워크 연결성 테스트
- **구현**: ping 명령어
- **필드**: Identifier, Sequence Number, Data

### 4.3.3 ICMP 활용

#### Ping (Packet Internet Groper)
```
ping 8.8.8.8
PING 8.8.8.8 (8.8.8.8): 56 data bytes
64 bytes from 8.8.8.8: icmp_seq=0 ttl=117 time=23.4 ms
64 bytes from 8.8.8.8: icmp_seq=1 ttl=117 time=24.1 ms
```

#### Traceroute/Tracert
- **원리**: TTL 값을 점진적으로 증가시켜 경로상의 라우터 발견
- **구현**: Unix/Linux (traceroute), Windows (tracert)

## 4.4 ARP (Address Resolution Protocol)

### 4.4.1 ARP 개요

#### ARP의 필요성
- **문제**: IP 주소를 알고 있지만 MAC 주소를 모르는 상황
- **해결**: IP 주소를 MAC 주소로 변환하는 프로토콜
- **계층**: 네트워크 계층과 데이터링크 계층 사이

#### ARP 동작 과정
1. **ARP Request**: 목적지 IP의 MAC 주소 요청 (브로드캐스트)
2. **ARP Reply**: 해당 IP를 가진 호스트가 자신의 MAC 주소 응답 (유니캐스트)
3. **ARP Cache**: 학습한 정보를 ARP 테이블에 저장

### 4.4.2 ARP 패킷 구조

```
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          Hardware Type        |          Protocol Type        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  HW Addr Len |  Proto Addr Len|            Operation          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Sender Hardware Address                    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Sender Protocol Address                    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Target Hardware Address                    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Target Protocol Address                    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

#### 필드 설명
- **Hardware Type**: 하드웨어 유형 (이더넷: 1)
- **Protocol Type**: 프로토콜 유형 (IP: 0x0800)
- **Operation**: 연산 유형 (Request: 1, Reply: 2)
- **Sender/Target Address**: 송신자/목적지 하드웨어/프로토콜 주소

### 4.4.3 ARP 관련 기술

#### Gratuitous ARP
- **정의**: 자신의 IP 주소에 대한 ARP 요청
- **목적**: IP 주소 중복 검사, ARP 캐시 업데이트
- **시점**: 인터페이스 활성화, IP 주소 변경

#### Proxy ARP
- **정의**: 다른 호스트를 대신하여 ARP 응답
- **용도**: 서브넷 간 통신, 라우터에서 구현
- **주의**: 보안 문제 및 네트워크 혼란 가능성

#### ARP Spoofing/Poisoning
- **공격 방법**: 가짜 ARP 응답으로 ARP 테이블 조작
- **목적**: 트래픽 가로채기, 중간자 공격
- **대응**: Dynamic ARP Inspection (DAI), Static ARP 엔트리

## 4.5 RARP (Reverse Address Resolution Protocol)

### 4.5.1 RARP 개요

#### RARP의 목적
- **기능**: MAC 주소를 IP 주소로 변환
- **사용 사례**: 디스크리스 워크스테이션의 부팅
- **현황**: DHCP에 의해 대체되어 현재는 거의 사용되지 않음

#### RARP 동작 과정
1. 클라이언트가 자신의 MAC 주소로 IP 주소 요청
2. RARP 서버가 MAC-IP 매핑 테이블 조회
3. 해당하는 IP 주소를 클라이언트에게 응답

### 4.5.2 RARP의 한계와 대안

#### RARP의 한계
- **제한적 정보**: IP 주소만 제공
- **브로드캐스트 의존**: 같은 물리적 네트워크에서만 동작
- **서버 설정 복잡**: 각 클라이언트별 수동 설정 필요

#### 대안 기술
**BOOTP (Bootstrap Protocol)**
- **개선사항**: 서브넷 마스크, 게이트웨이, DNS 서버 정보 제공
- **한계**: 여전히 정적 설정 필요

**DHCP (Dynamic Host Configuration Protocol)**
- **장점**: 동적 IP 할당, 다양한 네트워크 정보 제공
- **기능**: IP 주소 임대, 옵션 설정, 중앙 집중 관리

## 4.6 NAT (Network Address Translation)

### 4.6.1 NAT 개요

#### NAT의 필요성
- **IPv4 주소 부족**: 사설 IP 주소의 공인 IP 주소 변환
- **보안 향상**: 내부 네트워크 구조 은닉
- **비용 절감**: 적은 수의 공인 IP 주소로 다수 호스트 지원

#### NAT 동작 원리
1. **내부→외부**: 사설 IP를 공인 IP로 변환
2. **외부→내부**: 공인 IP를 사설 IP로 역변환
3. **NAT 테이블**: 변환 정보 저장 및 관리

### 4.6.2 NAT 유형

#### Static NAT (정적 NAT)
- **특징**: 1:1 고정 매핑
- **용도**: 서버 등 고정 접근이 필요한 호스트
- **예시**: 192.168.1.100 ↔ 203.123.45.10

#### Dynamic NAT (동적 NAT)
- **특징**: 공인 IP 풀에서 동적 할당
- **조건**: 사설 IP 수 ≤ 공인 IP 수
- **한계**: 공인 IP가 부족하면 접속 불가

#### PAT (Port Address Translation) / NAT Overload
- **특징**: 하나의 공인 IP에 포트 번호로 구분
- **장점**: 최소한의 공인 IP로 다수 호스트 지원
- **일반적 사용**: 가정용 라우터, 소규모 오피스

### 4.6.3 NAT의 장단점

#### 장점
- **IP 주소 절약**: 사설 IP 활용으로 공인 IP 절약
- **보안 강화**: 외부에서 내부 네트워크 직접 접근 차단
- **네트워크 관리**: 내부 IP 체계 독립적 관리

#### 단점
- **성능 저하**: 주소 변환으로 인한 지연
- **투명성 손실**: End-to-End 연결 특성 파괴
- **응용 프로그램 제약**: 특정 프로토콜(FTP, SIP 등)에서 문제
- **관리 복잡성**: NAT 테이블 관리 및 디버깅 어려움

## 연습문제

### 객관식 문제

1. IPv4 주소 192.168.10.150/28에서 사용 가능한 호스트 주소 개수는?
   ① 14개
   ② 15개  
   ③ 16개
   ④ 30개

2. VLSM의 주요 장점은?
   ① IP 주소 낭비 최소화
   ② 라우팅 테이블 크기 감소
   ③ 유연한 네트워크 설계
   ④ 모든 것

3. ping 명령어가 사용하는 ICMP 메시지 타입은?
   ① Type 3 (Destination Unreachable)
   ② Type 8/0 (Echo Request/Reply)
   ③ Type 11 (Time Exceeded)
   ④ Type 5 (Redirect)

### 주관식 문제

1. 172.16.0.0/16 네트워크를 다음 요구사항에 맞게 VLSM으로 설계하시오.
   - 본사: 1000대 호스트
   - 지사1: 500대 호스트
   - 지사2: 200대 호스트
   - WAN 링크 3개: 각각 2대씩

2. ARP Spoofing 공격의 원리와 대응 방안을 설명하시오.

3. NAT Overload(PAT)의 동작 과정을 패킷의 주소 변환 과정을 중심으로 상세히 설명하시오.

### 기술사 시험 유형 문제

**문제**: IPv6 도입에 따른 네트워크 인프라의 변화를 분석하고, IPv4와 IPv6 공존 전략을 제시하시오. 또한 대규모 기업 네트워크에서 IPv6 도입 시 고려해야 할 기술적 요소들과 단계별 도입 방안을 설명하시오.

**답안 작성 요령**:
1. IPv6 도입 배경 및 필요성
2. IPv4와 IPv6의 기술적 차이점 분석
3. 듀얼 스택, 터널링, 변환 기술 비교
4. 대규모 네트워크 IPv6 도입 전략
5. 보안 및 관리 측면의 고려사항

## 핵심 키워드 정리

- **IPv4**: 32비트 주소, 클래스 기반, 서브네팅
- **IPv6**: 128비트 주소, 계층적 구조, 내장 보안
- **VLSM**: 가변 길이 서브넷 마스크, IP 효율성
- **CIDR**: 클래스리스 라우팅, 슈퍼네팅
- **ICMP**: 오류 보고, ping, traceroute
- **ARP**: IP→MAC 변환, ARP 캐시
- **NAT**: 주소 변환, PAT, IPv4 절약
- **서브네팅**: 네트워크 분할, 브로드캐스트 도메인
- **사설 IP**: 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16

---

**다음 장 preview**: 5장에서는 라우팅 프로토콜의 종류와 특성, 라우팅 알고리즘, 그리고 RIP, OSPF, BGP 등 주요 라우팅 프로토콜의 동작 원리와 설정 방법에 대해 학습하겠습니다.

#IPv4 #IPv6 #서브네팅 #VLSM #ICMP #ARP #NAT #기술사시험